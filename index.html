<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Tiles 3 - Ø³Ø§Ø¯Ù‡</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(120deg,#1a2a6c,#b21f1f,#fdbb2d);
    background-size: 400% 400%;
    animation: bgmove 10s infinite alternate;
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
@keyframes bgmove {
    0% {background-position: 0% 50%;}
    100% {background-position: 100% 50%;}
}
#game {
    width: 320px;
    height: 480px;
    background: #000;
    overflow: hidden;
    position: relative;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}
.tile {
    position: absolute;
    width: 25%;
    height: 120px;
    background: #111;
    border: 1px solid #222;
    cursor: pointer;
    transition: background 0.1s;
}
.tile.black { background: #000; }
.tile.hit { background: #4CAF50; }
.tile.missed { background: #F44336; }
#score {
    position: absolute;
    top: 10px;
    left: 0;
    width: 100%;
    color: white;
    text-align: center;
    font-size: 20px;
    z-index: 10;
}
#gameover {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
button {
    margin-top: 15px;
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    background: #4CAF50;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}
button:hover { background: #388E3C; }
</style>
</head>
<body>
<div id="game">
    <div id="score">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
    <div id="gameover">
        <h2>Ø¨Ø§Ø®ØªÛŒ ðŸ˜¢</h2>
        <p>Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: <span id="final"></span></p>
        <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
    </div>
</div>

<audio id="music" preload="auto"></audio>

<script>
const MUSIC_LINKS = [
    "https://www.bensound.com/bensound-music/bensound-slowmotion.mp3",
    "https://www.bensound.com/bensound-music/bensound-tomorrow.mp3",
    "https://www.bensound.com/bensound-music/bensound-dreams.mp3"
];

const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const gameover = document.getElementById("gameover");
const finalScoreEl = document.getElementById("final");
const music = document.getElementById("music");

let tiles = [];
let speed = 2;
let score = 0;
let playing = false;
let gameLoop;
let songRate = 1;

function startGame() {
    clearInterval(gameLoop);
    tiles = [];
    game.innerHTML = `<div id="score">Ø§Ù…ØªÛŒØ§Ø²: 0</div><div id="gameover"><h2>Ø¨Ø§Ø®ØªÛŒ ðŸ˜¢</h2><p>Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: <span id="final"></span></p><button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button></div>`;
    scoreEl.textContent = "Ø§Ù…ØªÛŒØ§Ø²: 0";
    score = 0;
    speed = 2;
    playing = true;
    songRate = 1;
    gameover.style.display = "none";

    // Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ù‡Ù†Ú¯ ØªØµØ§Ø¯ÙÛŒ
    const song = MUSIC_LINKS[Math.floor(Math.random()*MUSIC_LINKS.length)];
    music.src = song;
    music.playbackRate = songRate;
    music.play();

    music.onended = () => {
        speed *= 1.5;
        songRate += 0.2;
        music.playbackRate = songRate;
        music.currentTime = 0;
        music.play();
    };

    spawnTile();
    gameLoop = setInterval(update, 16);
}

function spawnTile() {
    if(!playing) return;
    const col = Math.floor(Math.random()*4);
    const tile = document.createElement("div");
    tile.classList.add("tile","black");
    tile.style.left = (col*25)+"%";
    tile.style.top = "-120px";

    tile.onclick = () => {
        if(!playing) return;
        tile.classList.remove("black");
        tile.classList.add("hit");
        score++;
        scoreEl.textContent = "Ø§Ù…ØªÛŒØ§Ø²: "+score;
        tile.onclick = null;
        setTimeout(()=>tile.remove(),100);
    };

    game.appendChild(tile);
    tiles.push(tile);

    // Ù‡Ø± 600 ØªØ§ 900 Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡ Ú©Ø§Ø´ÛŒ Ø¬Ø¯ÛŒØ¯
    const delay = Math.random()*300+600;
    setTimeout(spawnTile, delay / songRate);
}

function update() {
    if(!playing) return;
    for(let i=tiles.length-1;i>=0;i--){
        const t = tiles[i];
        const y = parseFloat(t.style.top) + speed;
        t.style.top = y+"px";
        if(y > 480){
            if(t.classList.contains("black")) {
                endGame();
                return;
            } else {
                t.remove();
                tiles.splice(i,1);
            }
        }
    }
}

function endGame(){
    playing = false;
    clearInterval(gameLoop);
    music.pause();
    gameover.style.display = "flex";
    finalScoreEl.textContent = score;
}
startGame();
</script>
</body>
</html>
