<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¹ Magic Tiles Dream Mode</title>
<style>
body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background: linear-gradient(120deg, #000428, #004e92);
    font-family: "B Nazanin", Tahoma, sans-serif;
    user-select: none;
    transition: background 2s ease-in-out;
}
#game-container {
    width: 320px;
    height: 500px;
    background-color: rgba(0, 0, 0, 0.9);
    border-radius: 14px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 50px rgba(0, 255, 100, 0.4);
    backdrop-filter: blur(6px);
}
#score-display {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 1.8em;
    z-index: 10;
    text-shadow: 0 0 10px #00e676;
}
#game-area {
    width: 100%;
    height: 100%;
    position: relative;
}
.tile {
    position: absolute;
    width: 25%;
    height: 125px;
    background: linear-gradient(180deg, #00ff80, #007744);
    border-radius: 0 0 8px 8px;
    box-shadow: inset 0 -6px 0 rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: background-color 0.05s, transform 0.1s;
}
.tile.hit {
    background: linear-gradient(180deg, #FFD54F, #FFA000);
    transform: scale(1.05);
}
.tile.missed {
    background: linear-gradient(180deg, #E53935, #B71C1C);
}
#game-over-screen, #start-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
    backdrop-filter: blur(4px);
}
button {
    background-color: #00e676;
    border: none;
    color: white;
    font-size: 1.2em;
    border-radius: 8px;
    padding: 10px 25px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
}
button:hover {
    background-color: #00c853;
    transform: scale(1.05);
}
#speed-up {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #FFD700;
    font-size: 2em;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.8s ease-out;
    text-shadow: 0 0 15px #FFD700;
}
</style>
</head>
<body>

<div id="game-container">
    <div id="score-display">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
    <div id="game-area"></div>
    <div id="speed-up">ðŸŒŒ Ù…Ø±Ø­Ù„Ù‡ Ø³Ø±Ø¹Øª! âš¡</div>

    <div id="start-screen" style="display: flex;">
        <h1>ðŸŽ¹ Magic Tiles Dream Mode</h1>
        <button id="start-button">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ ðŸŽµ</button>
    </div>

    <div id="game-over-screen">
        <h1>ðŸŽ® Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯</h1>
        <p>Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: <span id="final-score">0</span></p>
        <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
    </div>
</div>

<audio id="bg-music" preload="auto"></audio>

<script>
// ðŸŽµ Ù„ÛŒØ³Øª Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§
const MUSIC_LINKS = [
    "https://www.bensound.com/bensound-music/bensound-tomorrow.mp3"
];

const gameArea = document.getElementById("game-area");
const scoreDisplay = document.getElementById("score-display");
const startScreen = document.getElementById("start-screen");
const gameOverScreen = document.getElementById("game-over-screen");
const finalScore = document.getElementById("final-score");
const audio = document.getElementById("bg-music");
const speedUpText = document.getElementById("speed-up");
const startButton = document.getElementById("start-button");

let score = 0;
let isGameOver = false;
let gameLoopInterval;
let tileMakerInterval;
let tileFallSpeed = 3;
let tileRate = 600;
let hardMode = false;

// ðŸŽ® Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
function startGame() {
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    gameArea.innerHTML = "";
    score = 0;
    isGameOver = false;
    hardMode = false;
    tileFallSpeed = 3;
    tileRate = 600;

    scoreDisplay.textContent = "Ø§Ù…ØªÛŒØ§Ø²: 0";
    gameOverScreen.style.display = "none";
    startScreen.style.display = "none";

    playMusicAndStart();
}

// ðŸŽµ Ù¾Ø®Ø´ Ù…ÙˆØ²ÛŒÚ© Ùˆ Ø³Ø§Ø®Øª Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§
function playMusicAndStart() {
    const musicSrc = MUSIC_LINKS[0];
    audio.src = musicSrc;
    audio.playbackRate = 1.0;
    audio.play();

    tileMakerInterval = setInterval(createTile, tileRate);

    audio.onended = () => {
        if (!hardMode) {
            activateHardMode();
        } else {
            endGame();
        }
    };

    gameLoopInterval = setInterval(gameLoop, 1000 / 60);
}

// ðŸ’¥ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø­Ø§Ù„Øª Ø³Ø±Ø¹Øª (Dream Mode)
function activateHardMode() {
    hardMode = true;
    tileFallSpeed *= 2;
    tileRate /= 2;

    clearInterval(tileMakerInterval);
    tileMakerInterval = setInterval(createTile, tileRate);

    // ðŸŒŒ Ø§ÙÚ©Øª Ø¨ØµØ±ÛŒ Ùˆ ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    document.body.style.background = "linear-gradient(120deg, #4b0082, #000000, #1e90ff)";
    document.body.style.boxShadow = "0 0 80px rgba(255,255,255,0.3)";
    speedUpText.style.opacity = 1;
    setTimeout(() => (speedUpText.style.opacity = 0), 1500);

    // ðŸŽµ Ù¾Ø®Ø´ Ù‡Ù…Ø§Ù† Ù…ÙˆØ²ÛŒÚ© Ø¨Ø§ Ø³Ø±Ø¹Øª Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø±
    const musicSrc = MUSIC_LINKS[0];
    audio.src = musicSrc;
    audio.playbackRate = 1.8;
    audio.play();

    audio.onended = () => endGame();
}

// ðŸŽµ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø´ÛŒ
function createTile() {
    if (isGameOver) return;
    const tile = document.createElement("div");
    tile.classList.add("tile");
    const column = Math.floor(Math.random() * 4);
    tile.style.left = `${column * 25}%`;
    tile.style.top = `-125px`;

    tile.onclick = () => {
        if (isGameOver) return;
        tile.classList.add("hit");
        score++;
        scoreDisplay.textContent = `Ø§Ù…ØªÛŒØ§Ø²: ${score}`;
        tile.onclick = null;
        setTimeout(() => tile.remove(), 100);
    };

    gameArea.appendChild(tile);
}

// ðŸ”„ Ø­Ø±Ú©Øª Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§
function gameLoop() {
    if (isGameOver) return;

    const tiles = document.querySelectorAll(".tile");
    tiles.forEach(tile => {
        const currentY = parseFloat(tile.style.top || 0);
        const newY = currentY + tileFallSpeed;
        tile.style.top = `${newY}px`;

        if (newY > gameArea.clientHeight) {
            endGame(tile);
        }
    });
}

// âŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
function endGame(tile) {
    if (isGameOver) return;
    isGameOver = true;
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    audio.pause();
    if (tile) tile.classList.add("missed");
    finalScore.textContent = score;
    gameOverScreen.style.display = "flex";
}

// ðŸŽ¬ Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹
startButton.onclick = () => startGame();
</script>
</body>
</html>
