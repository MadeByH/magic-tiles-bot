<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Tiles Infinity</title>
<style>
body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'B Nazanin', Tahoma, sans-serif;
    user-select: none;
    background: linear-gradient(120deg,#000428,#004e92);
    transition: background 1s;
}
#game-container {
    width: 320px;
    height: 500px;
    background-color: #111;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
#score-display {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    color: white;
    font-size: 1.8em;
    z-index: 10;
}
#game-area {
    width: 100%;
    height: 100%;
    position: relative;
}
.tile {
    position: absolute;
    width: 25%;
    height: 125px;
    background-color: #222;
    cursor: pointer;
    border-radius: 0 0 5px 5px;
    box-shadow: inset 0 -5px 0 #000;
    transition: background-color 0.05s, transform 0.1s;
}
.tile.hit {
    background-color: #4CAF50;
    transform: scale(1.05);
}
.tile.missed {
    background-color: #F44336;
}
#game-over-screen {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    display:none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color:white;
    text-align:center;
}
#game-over-screen button {
    padding: 10px 20px;
    font-size: 1.2em;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
}
#game-over-screen button:hover {background-color:#388E3C;}
</style>
</head>
<body>

<div id="game-container">
    <div id="score-display">امتیاز: 0</div>
    <div id="game-area"></div>
    <div id="game-over-screen">
        <h1>بازی تمام شد!</h1>
        <p>امتیاز نهایی: <span id="final-score">0</span></p>
        <button onclick="startGame()">شروع مجدد</button>
    </div>
</div>

<audio id="bg-music" preload="auto"></audio>

<script>
const MUSIC_LINKS = [
"https://www.bensound.com/bensound-music/bensound-slowmotion.mp3",
"https://www.bensound.com/bensound-music/bensound-tomorrow.mp3",
"https://www.bensound.com/bensound-music/bensound-tenderness.mp3",
"https://www.bensound.com/bensound-music/bensound-sweet.mp3",
"https://www.bensound.com/bensound-music/bensound-dreams.mp3",
"https://www.bensound.com/bensound-music/bensound-love.mp3",
"https://www.bensound.com/bensound-music/bensound-onceagain.mp3",
"https://www.bensound.com/bensound-music/bensound-creativeminds.mp3"
];

const gameArea = document.getElementById("game-area");
const scoreDisplay = document.getElementById("score-display");
const gameOverScreen = document.getElementById("game-over-screen");
const finalScore = document.getElementById("final-score");
const audio = document.getElementById("bg-music");

let score = 0;
let isGameOver = false;
let tileFallSpeed = 3;
let tileRate = 600;
let currentSong = "";
let tiles = [];

function randomGradient() {
    const colors = [
        ["#000428","#004e92"],["#4b0082","#000000"],
        ["#1e3c72","#2a5298"],["#0f2027","#203a43","#2c5364"],
        ["#141E30","#243B55"]
    ];
    const c = colors[Math.floor(Math.random()*colors.length)];
    return `linear-gradient(120deg, ${c.join(",")})`;
}

function startGame() {
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    gameArea.innerHTML = "";
    score = 0; tileFallSpeed=3; tileRate=600; isGameOver=false;
    tiles=[]; scoreDisplay.textContent="امتیاز: 0";
    gameOverScreen.style.display="none";
    document.body.style.background=randomGradient();

    // انتخاب رندوم آهنگ
    currentSong = MUSIC_LINKS[Math.floor(Math.random()*MUSIC_LINKS.length)];
    audio.src = currentSong;
    audio.playbackRate = 1;
    audio.play();

    tileMakerInterval = setInterval(createTile, tileRate);
    gameLoopInterval = setInterval(gameLoop,1000/60);

    audio.onended = () => {
        tileFallSpeed += 1;
        audio.playbackRate += 0.1;
        audio.play();
    };
}

function createTile() {
    if(isGameOver) return;
    const tile = document.createElement("div");
    tile.classList.add("tile");
    const col = Math.floor(Math.random()*4);
    tile.style.left=`${col*25}%`;
    tile.style.top="-125px";

    tile.onclick = () => {
        if(isGameOver) return;
        tile.classList.add("hit");
        score++;
        scoreDisplay.textContent=`امتیاز: ${score}`;
        tile.onclick=null;
        setTimeout(()=>tile.remove(),100);
    };

    tiles.push(tile);
    gameArea.appendChild(tile);
}

function gameLoop() {
    if(isGameOver) return;
    for(let i=tiles.length-1;i>=0;i--){
        const t = tiles[i];
        const y = parseFloat(t.style.top||0)+tileFallSpeed;
        t.style.top=`${y}px`;
        if(y>gameArea.clientHeight){
            endGame(t);
        }
    }
}

function endGame(tile){
    if(isGameOver) return;
    isGameOver=true;
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    audio.pause();
    if(tile) tile.classList.add("missed");
    finalScore.textContent=score;
    gameOverScreen.style.display="flex";
}

let gameLoopInterval, tileMakerInterval;
startGame();
</script>
</body>
</html>
