<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸµ Magic Tiles Ø³Ø§Ø¯Ù‡</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  background-size: 400% 400%;
  animation: bg 10s ease infinite;
  font-family: sans-serif;
}
@keyframes bg {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
#game {
  width: 320px;
  height: 500px;
  background: #000;
  position: relative;
  overflow: hidden;
  border-radius: 10px;
  box-shadow: 0 0 25px rgba(0,0,0,0.5);
}
.tile {
  position: absolute;
  width: 25%;
  height: 120px;
  background: #000;
  border: 1px solid #111;
  cursor: pointer;
  transition: background 0.1s, transform 0.1s;
}
.tile.hit {
  background: #4caf50;
  transform: scale(1.05);
}
.tile.missed {
  background: #f44336;
}
#score {
  position: absolute;
  top: 10px;
  width: 100%;
  color: white;
  text-align: center;
  font-size: 20px;
  z-index: 10;
}
#gameover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  color: white;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
button {
  margin-top: 10px;
  background: #4caf50;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 1em;
  cursor: pointer;
}
button:hover {
  background: #388e3c;
}
</style>
</head>
<body>
<div id="game">
  <div id="score">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
  <div id="gameover">
    <h2>Ø¨Ø§Ø®ØªÛŒ ğŸ˜¢</h2>
    <p>Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: <span id="finalScore"></span></p>
    <button onclick="startGame()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
  </div>
</div>

<audio id="music" preload="auto"></audio>

<script>
const MUSIC_LINKS = [
  "https://www.bensound.com/bensound-music/bensound-slowmotion.mp3",
  "https://www.bensound.com/bensound-music/bensound-tomorrow.mp3",
  "https://www.bensound.com/bensound-music/bensound-dreams.mp3"
];

const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const gameover = document.getElementById("gameover");
const finalScoreEl = document.getElementById("finalScore");
const music = document.getElementById("music");

let tiles = [];
let score = 0;
let speed = 2;
let playing = false;
let songRate = 1;
let spawnInterval, gameLoop;

function startGame() {
  clearInterval(spawnInterval);
  clearInterval(gameLoop);
  tiles.forEach(t => t.remove());
  tiles = [];
  score = 0;
  speed = 2;
  songRate = 1;
  scoreEl.textContent = "Ø§Ù…ØªÛŒØ§Ø²: 0";
  gameover.style.display = "none";
  playing = true;

  // Ø¢Ù‡Ù†Ú¯ ØªØµØ§Ø¯ÙÛŒ
  const song = MUSIC_LINKS[Math.floor(Math.random() * MUSIC_LINKS.length)];
  music.src = song;
  music.playbackRate = songRate;
  music.play();

  // ÙˆÙ‚ØªÛŒ Ø¢Ù‡Ù†Ú¯ ØªÙ…ÙˆÙ… Ø´Ø¯ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù¾Ø®Ø´ Ú©Ù† Ùˆ Ø³Ø±Ø¹Øª Ø±Ùˆ Ø¨ÛŒØ´ØªØ± Ú©Ù†
  music.onended = () => {
    speed *= 1.3;
    songRate += 0.1;
    music.playbackRate = songRate;
    music.currentTime = 0;
    music.play();
  };

  spawnInterval = setInterval(spawnTile, 700);
  gameLoop = setInterval(update, 16);
}

function spawnTile() {
  if (!playing) return;
  const col = Math.floor(Math.random() * 4);
  const lastTile = tiles[tiles.length - 1];
  // ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§
  if (lastTile && parseFloat(lastTile.style.top) < 0) return;

  const tile = document.createElement("div");
  tile.classList.add("tile");
  tile.style.left = (col * 25) + "%";
  tile.style.top = "-120px";

  tile.onclick = () => {
    if (!playing) return;
    tile.classList.add("hit");
    tile.onclick = null;
    score++;
    scoreEl.textContent = "Ø§Ù…ØªÛŒØ§Ø²: " + score;
    setTimeout(() => tile.remove(), 100);
  };

  game.appendChild(tile);
  tiles.push(tile);
}

function update() {
  if (!playing) return;
  for (let i = tiles.length - 1; i >= 0; i--) {
    const t = tiles[i];
    const y = parseFloat(t.style.top) + speed;
    t.style.top = y + "px";
    if (y > game.clientHeight) {
      if (!t.classList.contains("hit")) {
        t.classList.add("missed");
        endGame();
        return;
      } else {
        t.remove();
        tiles.splice(i, 1);
      }
    }
  }
}

function endGame() {
  playing = false;
  clearInterval(spawnInterval);
  clearInterval(gameLoop);
  music.pause();
  finalScoreEl.textContent = score;
  gameover.style.display = "flex";
}
startGame();
</script>
</body>
</html>
