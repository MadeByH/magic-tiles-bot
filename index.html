<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎵 Magic Tiles Infinity</title>
<style>
body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(120deg,#141E30,#243B55);
    transition: background 1s;
    user-select: none;
    font-family: 'B Nazanin', Tahoma;
}
#game-container {
    width: 320px;
    height: 500px;
    background-color: #000;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 30px rgba(0,0,0,0.7);
}
#score-display {
    position: absolute;
    top: 8px;
    width: 100%;
    text-align: center;
    color: white;
    font-size: 1.6em;
    z-index: 10;
}
#game-area {
    width: 100%;
    height: 100%;
    position: relative;
}
.tile {
    position: absolute;
    width: 25%;
    height: 125px;
    background-color: #111;
    border: 1px solid #333;
    box-shadow: inset 0 -5px 0 #000;
    cursor: pointer;
}
.black-tile {
    background-color: #000;
}
.tile.hit {
    background-color: #4CAF50 !important;
}
.tile.missed {
    background-color: #F44336 !important;
}
#game-over-screen {
    position: absolute;
    top:0;left:0;
    width:100%;height:100%;
    background: rgba(0,0,0,0.85);
    display:none;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    color:white;
    text-align:center;
}
#game-over-screen button {
    background:#4CAF50;
    border:none;
    padding:10px 20px;
    color:white;
    font-size:1.1em;
    border-radius:5px;
    cursor:pointer;
}
#game-over-screen button:hover {
    background:#388E3C;
}
</style>
</head>
<body>
<div id="game-container">
    <div id="score-display">امتیاز: 0</div>
    <div id="game-area"></div>
    <div id="game-over-screen">
        <h1>بازی تمام شد!</h1>
        <p>امتیاز نهایی: <span id="final-score">0</span></p>
        <button onclick="startGame()">شروع مجدد</button>
    </div>
</div>
<audio id="bg-music" preload="auto"></audio>

<script>
const MUSIC_LINKS = [
"https://www.bensound.com/bensound-music/bensound-slowmotion.mp3",
"https://www.bensound.com/bensound-music/bensound-tomorrow.mp3",
"https://www.bensound.com/bensound-music/bensound-tenderness.mp3",
"https://www.bensound.com/bensound-music/bensound-sweet.mp3",
"https://www.bensound.com/bensound-music/bensound-dreams.mp3",
"https://www.bensound.com/bensound-music/bensound-love.mp3",
"https://www.bensound.com/bensound-music/bensound-onceagain.mp3",
"https://www.bensound.com/bensound-music/bensound-creativeminds.mp3"
];

const gameArea = document.getElementById("game-area");
const scoreDisplay = document.getElementById("score-display");
const gameOverScreen = document.getElementById("game-over-screen");
const finalScore = document.getElementById("final-score");
const audio = document.getElementById("bg-music");

let tiles = [];
let score = 0;
let isGameOver = false;
let speed = 2.5;
let tileInterval = 700;
let lastTileY = -125;
let currentSong = "";

function startGame() {
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    gameArea.innerHTML = "";
    tiles = [];
    score = 0;
    speed = 2.5;
    tileInterval = 700;
    lastTileY = -125;
    isGameOver = false;
    scoreDisplay.textContent = "امتیاز: 0";
    gameOverScreen.style.display = "none";

    // انتخاب تصادفی آهنگ
    currentSong = MUSIC_LINKS[Math.floor(Math.random() * MUSIC_LINKS.length)];
    audio.src = currentSong;
    audio.playbackRate = 1;
    audio.play();

    tileMakerInterval = setInterval(createTileRow, tileInterval);
    gameLoopInterval = setInterval(updateGame, 1000 / 60);

    // وقتی آهنگ تموم بشه، سرعت زیاد شه و دوباره پخش بشه
    audio.onended = () => {
        speed += 0.8;
        audio.playbackRate += 0.1;
        audio.play();
    };
}

function createTileRow() {
    if (isGameOver) return;
    const row = document.createElement("div");
    const col = Math.floor(Math.random() * 4);
    const tile = document.createElement("div");
    tile.classList.add("tile", "black-tile");
    tile.style.left = `${col * 25}%`;
    tile.style.top = `${lastTileY}px`;

    tile.onclick = () => {
        if (isGameOver) return;
        tile.classList.remove("black-tile");
        tile.classList.add("hit");
        tile.onclick = null;
        score++;
        scoreDisplay.textContent = `امتیاز: ${score}`;
        // حذف از آرایه وقتی زده شد
        tiles = tiles.filter(t => t !== tile);
        setTimeout(() => tile.remove(), 100);
        // افزایش تدریجی سرعت
        if (score % 15 === 0) speed += 0.3;
    };

    gameArea.appendChild(tile);
    tiles.push(tile);
    lastTileY -= 125;
}

function updateGame() {
    if (isGameOver) return;
    tiles.forEach(tile => {
        const y = parseFloat(tile.style.top) + speed;
        tile.style.top = `${y}px`;
        if (y > gameArea.clientHeight) {
            endGame(tile);
        }
    });
    tiles = tiles.filter(tile => parseFloat(tile.style.top) <= gameArea.clientHeight);
}

function endGame(tile) {
    if (isGameOver) return;
    isGameOver = true;
    clearInterval(gameLoopInterval);
    clearInterval(tileMakerInterval);
    audio.pause();
    if (tile) tile.classList.add("missed");
    finalScore.textContent = score;
    gameOverScreen.style.display = "flex";
}

let gameLoopInterval, tileMakerInterval;
startGame();
</script>
</body>
</html>
